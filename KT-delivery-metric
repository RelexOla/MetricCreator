
begin_trx.cube
    .slice("products", "code == 'FNETOHJMFKFJ08DS'")
    .slice("locations", "code == '8174'")
    .slice(LocalDate.new.plusDays(2),LocalDate.new.plusDays(2))
    .view("product_locations",
          "

sum(simulated_values.delivered_orders_quantity) - period[$today, $today](sum(order_proposals.delivery_date >= $parent_start && order_proposals.delivery_date <= $parent_end && order_proposals.effective_quantity))
as tql

"
    )
.first.get_attribute("tql")



- sum(order_proposals.date = $today && order_proposals.delivery_date >= $start && order_proposals.delivery_date <= $end && order_proposals.effective_quantity)


18623
sum(simulated_values.delivered_orders_quantity) -
sum(order_proposals.date = $today && order_proposals.effective_quantity)


AQ9Q2HSUEBXRFS57 / PRISMA (SAHATTU 32X100 PL/VL / PRISMA)


$ui_config.custom_extend(MetricRenderer) do
    group :test_1 do |g|
        g.metric :customer_delivery_metric, "Delivery forecast - todays proposals",
        :tql => "sum(simulated_values.delivered_orders_quantity) - period[$today, $today](sum(order_proposals.delivery_date >= $parent_start && order_proposals.delivery_date <= $parent_end && order_proposals.effective_quantity) || 0)"

         end; end;

         MetricRenderer.all_fields.select{ |f|
             f.name == :customer_test_metric_ola_1
         }.first.options[:tql] = "sum(simulated_values.delivered_orders_quantity) - period[$today, $today](sum(order_proposals.delivery_date >= $parent_start && order_proposals.delivery_date <= $parent_end && order_proposals.effective_quantity) || 0)"


$ui_config.custom_extend(MetricRenderer) do
    group :test_1 do |g|
        g.metric :customer_test_metric_ola_2, "parent start",
        :tql => "period[$today,$today]($parent_start)"         end; end;